# 现代化数据库管理系统

[![Python](https://img.shields.io/badge/Python-3.8%2B-blue)](https://www.python.org/)
[![License](https://img.shields.io/badge/License-MIT-green)](LICENSE)
[![Build Status](https://img.shields.io/badge/Build-Passing-brightgreen)](https://github.com/your-username/database-system)

这是一个功能完整的现代化数据库管理系统实现，包含SQL编译器前端、存储引擎和执行引擎，支持完整的SQL语法和高级数据库功能。

## 📋 目录

- [项目概述](#项目概述)
- [系统架构](#系统架构)
- [核心功能](#核心功能)
- [技术特性](#技术特性)
- [项目结构](#项目结构)
- [安装与运行](#安装与运行)
- [使用示例](#使用示例)
- [支持的SQL语法](#支持的sql语法)
- [性能特性](#性能特性)
- [测试](#测试)
- [开发进度](#开发进度)
- [贡献](#贡献)
- [许可证](#许可证)

## 项目概述

本项目实现了一个完整的数据库管理系统，涵盖了从SQL解析到数据存储的全过程。系统采用模块化设计，包含以下核心组件：

1. **SQL编译器前端**：词法分析、语法分析、语义分析和代码生成
2. **存储引擎**：基于页的存储管理、缓存管理和表结构管理
3. **执行引擎**：目标代码解释执行和查询操作执行

该系统可以作为学习数据库系统原理的优秀示例，也可以作为实际应用的基础。

## 系统架构

```
┌─────────────────────────────────────────────────────────────┐
│                    用户接口层 (User Interface)              │
│  ┌─────────────┐  ┌──────────────┐  ┌────────────────────┐ │
│  │ 命令行界面  │  │  Web界面     │  │  图形化界面        │ │
│  └─────────────┘  └──────────────┘  └────────────────────┘ │
├─────────────────────────────────────────────────────────────┤
│                    SQL处理器层 (SQL Processor)             │
│  ┌─────────────┐  ┌──────────────┐  ┌────────────────────┐ │
│  │ 统一SQL处理 │  │  词法分析器  │  │  语法分析器        │ │
│  │   器        │  │              │  │                    │ │
│  └─────────────┘  └──────────────┘  └────────────────────┘ │
│  ┌─────────────────────────────────────────────────────────┤
│  │                  语义分析器                             │
│  └─────────────────────────────────────────────────────────┤
│  │                  代码生成器                             │
│  └─────────────────────────────────────────────────────────┘
├─────────────────────────────────────────────────────────────┤
│                    执行引擎层 (Execution Engine)           │
│  ┌─────────────────────────────────────────────────────────┤
│  │                  目标代码执行器                         │
│  └─────────────────────────────────────────────────────────┤
│  │                  查询优化器                             │
│  └─────────────────────────────────────────────────────────┘
├─────────────────────────────────────────────────────────────┤
│                    存储引擎层 (Storage Engine)             │
│  ┌─────────────┐  ┌──────────────┐  ┌────────────────────┐ │
│  │  表管理器   │  │  缓存管理器  │  │  页管理器          │ │
│  └─────────────┘  └──────────────┘  └────────────────────┘ │
│  ┌─────────────────────────────────────────────────────────┤
│  │                  B+树索引管理器                         │
│  └─────────────────────────────────────────────────────────┘
└─────────────────────────────────────────────────────────────┘
```

## 核心功能

### 1. SQL编译器前端
- **词法分析器**：将SQL语句分解为Token序列
- **语法分析器**：使用LL(1)文法进行语法检查
- **语义分析器**：进行语义检查并生成中间代码
- **代码生成器**：将中间代码转换为目标指令

### 2. 存储引擎
- **页式存储管理**：固定4KB页面大小，支持多种页类型
- **缓存管理器**：支持LRU/FIFO/Clock替换策略
- **表结构管理**：完整的表定义、创建、删除和修改功能
- **B+树索引**：高效的范围查询索引支持

### 3. 执行引擎
- **目标代码解释器**：执行编译器生成的目标指令
- **查询优化器**：基于成本的查询计划优化
- **聚合函数支持**：COUNT, SUM, AVG, MAX, MIN等

### 4. 高级特性
- **复杂查询支持**：JOIN操作、GROUP BY、ORDER BY
- **事务支持**：ACID事务特性（部分实现）
- **约束管理**：主键、外键、唯一性、非空约束
- **数据持久化**：所有数据和元数据通过页式存储持久化

## 技术特性

### 编译器技术
- LL(1)语法分析
- 抽象语法树(AST)构建
- 四元式中间代码生成
- 目标指令集定义和翻译

### 存储技术
- 基于页的存储管理（4KB页面）
- 多种页面替换算法（LRU/FIFO/Clock）
- 数据校验和验证
- 高效的缓存命中机制

### 查询处理
- 查询计划优化
- 索引选择优化
- 执行计划缓存
- 多表连接优化

### 系统特性
- 模块化架构设计
- 线程安全的缓存管理
- 完善的错误处理机制
- 详细的性能统计信息

## 项目结构

```
DB/
├── src/                          # 源代码目录
│   ├── compiler/                 # SQL编译器前端
│   │   ├── lexer/               # 词法分析器
│   │   ├── parser/              # 语法分析器
│   │   ├── semantic/            # 语义分析器
│   │   └── codegen/             # 代码生成器
│   ├── storage/                 # 存储管理系统
│   │   ├── page/                # 页管理
│   │   ├── buffer/              # 缓存管理
│   │   ├── table/               # 表结构管理
│   │   └── index/               # 索引管理
│   ├── execution/               # 执行引擎
│   └── common/                  # 公共模块
├── tests/                       # 测试文件
├── examples/                    # 示例SQL文件
├── docs/                        # 文档
├── streamlit_app.py             # Streamlit Web界面
├── main.py                      # 命令行主程序
└── modern_database_manager.py   # 图形化管理界面
```

## 安装与运行

### 环境要求
- Python 3.8 或更高版本
- Windows/Linux/macOS 操作系统

### 安装步骤
```bash
# 克隆项目
git clone <repository-url>
cd DB

# 项目无需额外依赖，直接运行即可
```

### 运行方式

#### 1. Web界面模式
```bash
# 启动Streamlit Web界面
streamlit run streamlit_app.py
```

#### 2. 图形化界面模式
```bash
# 启动图形化管理器
python modern_database_manager.py
```

## 使用示例

### 基本查询示例
```sql
-- 创建表
CREATE TABLE students (
    id INTEGER PRIMARY KEY,
    name VARCHAR(50),
    age INTEGER,
    grade FLOAT
);

-- 插入数据
INSERT INTO students VALUES (1, 'Alice', 20, 85.5);
INSERT INTO students VALUES (2, 'Bob', 22, 92.0);

-- 查询数据
SELECT * FROM students WHERE age > 20;
SELECT name, grade FROM students WHERE grade >= 90;

-- 聚合查询
SELECT COUNT(*) FROM students;
SELECT AVG(grade) FROM students;
```

### 复杂查询示例
```sql
-- JOIN查询
SELECT s.name, c.course_name 
FROM students s 
JOIN courses c ON s.id = c.student_id;

-- 分组查询
SELECT major, COUNT(*), AVG(grade) 
FROM students 
GROUP BY major;

-- 排序和限制
SELECT * FROM students 
ORDER BY grade DESC 
LIMIT 5;
```

## 支持的SQL语法

### DDL语句
- `CREATE TABLE` - 创建表
- `DROP TABLE` - 删除表
- `ALTER TABLE` - 修改表结构
- `CREATE INDEX` - 创建索引

### DML语句
- `INSERT INTO` - 插入数据
- `UPDATE` - 更新数据
- `DELETE FROM` - 删除数据

### 查询语句
- `SELECT` - 基本查询
- `WHERE` - 条件过滤
- `JOIN` - 表连接（INNER JOIN, LEFT JOIN等）
- `GROUP BY` - 分组查询
- `ORDER BY` - 排序查询
- `LIMIT/OFFSET` - 结果集分页
- 聚合函数：COUNT, SUM, AVG, MAX, MIN

### 数据类型
- INTEGER - 整数类型
- FLOAT - 浮点数类型
- VARCHAR - 可变长度字符串
- TEXT - 长文本类型
- BOOLEAN - 布尔类型
- DATE - 日期类型

### 约束支持
- PRIMARY KEY - 主键约束
- UNIQUE - 唯一性约束
- NOT NULL - 非空约束
- DEFAULT - 默认值约束

## 性能特性

### 缓存管理
- LRU/FIFO/Clock页面替换算法
- 智能缓存命中优化
- 脏页自动刷新机制
- 缓存命中率统计

### 查询优化
- 基于成本的查询计划优化
- 索引选择优化
- 谓词下推优化
- 连接顺序优化

### 存储优化
- 4KB固定页面大小
- 高效的页面序列化/反序列化
- 校验和数据验证
- 页级读写操作

## 测试

项目包含全面的测试套件，覆盖以下方面：

1. **基础功能测试**：词法分析、语法分析、语义分析
2. **查询功能测试**：SELECT、INSERT、UPDATE、DELETE
3. **聚合函数测试**：COUNT、SUM、AVG、MAX、MIN
4. **复杂查询测试**：JOIN、GROUP BY、ORDER BY
5. **约束验证测试**：主键、唯一性、非空约束
6. **性能测试**：缓存命中率、查询响应时间


## 开发进度

- [x] SQL编译器前端（词法分析、语法分析、语义分析）
- [x] 目标代码生成器
- [x] 存储引擎（页管理、缓存管理、表管理）
- [x] 执行引擎
- [x] B+树索引实现
- [x] 图形化界面实现
- [x] 完整SQL语法支持
- [x] 查询优化器
- [ ] 分布式支持
- [ ] 完整事务管理

## 贡献

欢迎任何形式的贡献！如果您想参与项目开发，请：

1. Fork 项目
2. 创建功能分支 (`git checkout -b feature/AmazingFeature`)
3. 提交更改 (`git commit -m 'Add some AmazingFeature'`)
4. 推送到分支 (`git push origin feature/AmazingFeature`)
5. 开启 Pull Request

## 许可证

本项目采用 MIT 许可证 - 查看 [LICENSE](LICENSE) 文件了解详情

---

**项目状态**: 稳定 ✅ | **维护状态**: 积极开发 🚀 | **版本**: 1.0.0
