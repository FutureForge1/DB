# 🌐 分布式数据库系统测试指南

## 📋 测试准备

### 1. 启动应用程序
运行 `python modern_database_manager.py` 启动现代化数据库管理系统

### 2. 进入分布式管理页面
点击 **🌐 分布式管理** 标签页

---

## 🚀 分布式功能测试步骤

### 第一步：启动分布式集群

1. **启动集群**
   - 点击 **🚀 启动集群** 按钮
   - 系统会自动创建3个节点：node1, node2, node3
   - 观察集群状态显示区域，应该显示：
     ```
     ✅ 分布式集群启动成功！
     包含节点: node1, node2, node3
     ```

2. **查看集群状态**
   - 点击 **🔄 刷新状态** 按钮
   - 观察集群健康度、节点状态等信息

---

### 第二步：创建分片表（📊 分片管理）

1. **切换到分片管理标签页**
   
2. **创建分片表**
   - 表名：`users`
   - 分片键：`user_id`
   - 分片类型：`hash`（推荐）
   - 分片数量：`3`
   - 点击 **创建分片表** 按钮

3. **验证分片创建**
   - 观察分片信息区域显示分片详情
   - 应该显示3个分片分布在不同节点上

---

### 第三步：设置数据复制（🔄 复制管理）

1. **切换到复制管理标签页**

2. **创建复制组**
   - 复制组ID：`replica_group_1`
   - 一致性级别：`eventual`（最终一致性）
   - 点击 **创建复制组** 按钮

3. **加入复制组**
   - 复制组ID：`replica_group_1`
   - 点击 **加入复制组** 按钮
   - 系统会将当前节点作为主节点加入

4. **查看复制状态**
   - 观察复制状态区域显示复制组信息

---

### 第四步：测试分布式事务（💳 分布式事务）

1. **切换到分布式事务标签页**

2. **开始分布式事务**
   - 隔离级别：选择 `read_committed`（推荐）
   - 点击 **开始事务** 按钮
   - 系统会显示事务ID，记下这个ID

3. **模拟事务操作**
   ```
   此时事务已开始，您可以在主查询页面执行以下SQL操作：
   - 插入数据到分片表
   - 更新数据
   - 查询数据
   ```

4. **提交或回滚事务**
   - **提交事务**：点击 **提交事务** 按钮
   - **回滚事务**：点击 **回滚事务** 按钮

5. **观察事务统计**
   - 查看事务状态区域显示的统计信息
   - 包括协调器统计、参与者统计、锁统计等

---

### 第五步：性能监控（📈 性能监控）

1. **切换到性能监控标签页**

2. **获取性能指标**
   - 点击 **📊 获取性能指标** 按钮
   - 查看系统性能数据（JSON格式）

3. **查看慢查询**
   - 点击 **🐌 查看慢查询** 按钮
   - 查看系统中的慢查询记录

4. **刷新监控信息**
   - 点击 **🔄 刷新监控** 按钮
   - 获取最新的系统状态信息

---

## 🧪 具体测试案例

### 测试案例1：跨分片查询
```sql
-- 在主查询页面执行
INSERT INTO users (user_id, name, email) VALUES 
(1, 'Alice', 'alice@example.com'),
(2, 'Bob', 'bob@example.com'),
(3, 'Charlie', 'charlie@example.com');

-- 查询所有用户（跨分片）
SELECT * FROM users;
```

### 测试案例2：分布式事务完整流程
```sql
-- 1. 在分布式事务页面开始事务
-- 2. 在主查询页面执行多个操作
INSERT INTO users (user_id, name, email) VALUES (4, 'David', 'david@example.com');
UPDATE users SET name = 'Alice Smith' WHERE user_id = 1;
-- 3. 返回分布式事务页面提交事务
```

### 测试案例3：事务回滚测试
```sql
-- 1. 开始事务
-- 2. 执行一些操作
INSERT INTO users (user_id, name, email) VALUES (5, 'Eve', 'eve@example.com');
-- 3. 故意造成错误或直接回滚事务
-- 4. 验证数据是否回滚
```

---

## 🔍 预期结果

### 成功指标：
- ✅ 集群成功启动，3个节点都显示为活跃状态
- ✅ 分片表创建成功，数据分布在不同分片上
- ✅ 复制组创建成功，主从关系建立
- ✅ 分布式事务能够正常开始、提交和回滚
- ✅ 性能监控显示系统运行状态
- ✅ 跨分片查询能够返回正确结果

### 注意事项：
- 🔸 分布式系统可能会有网络延迟模拟
- 🔸 事务超时时间为预设值，长时间不操作会自动超时
- 🔸 内存使用率较高时系统会发出警告
- 🔸 节点故障检测会在控制台显示相关日志

---

## 🛠️ 故障排除

### 常见问题：
1. **集群启动失败**
   - 检查端口是否被占用
   - 重启应用程序重试

2. **分片表创建失败**
   - 确保集群已成功启动
   - 检查表名和分片键是否有效

3. **事务提交失败**
   - 检查网络连接状态
   - 查看事务是否超时

4. **内存占用过高**
   - 停止不必要的后台进程
   - 重启应用程序

---

## 📝 测试记录模板

```
测试日期：________
测试人员：________

分布式集群启动：□ 成功 □ 失败
分片表创建：    □ 成功 □ 失败
复制组设置：    □ 成功 □ 失败
分布式事务：    □ 成功 □ 失败
性能监控：      □ 成功 □ 失败

备注：
_________________________________
_________________________________
```

开始您的分布式数据库测试之旅吧！🎉
